# 渲染管线及小组件

## 渲染管线
### /script/lib_global/view/view.php
使用静态类 `view::<functionname>` 进行渲染控制，采用函数方式渲染可重用HTML组件而非传统include方法，提高代码复用性和参数传递灵活性。

#### 函数列表

##### 基础渲染函数
- **`header($title = "主页", $nav = 1, $oh = "")`**
  - **参数**：
    - `$title`: 页面标题（默认"主页"），自动附加全局后缀 `$GLOBALS['titleSuffix']`
    - `$nav`: 是否显示导航栏:  0:完全显示  1：只显示图标 2：隐藏边栏 3：隐藏所有
    - `$oh`: 额外的头部HTML内容（如meta标签、自定义样式等）
  - **功能**：生成标准HTML头部结构，包括DOCTYPE声明、head区域、标题设置和导航栏渲染，同时开启主内容区域容器
  - **输出**：完整的HTML头部及导航结构，为页面主体内容做准备

- **`foot()`**
  - **功能**：闭合主内容区域容器，引入HTML尾部文件，并调用import()方法输出全局资源
  - **注意**：此方法必须与header()配对使用，确保HTML结构完整性

- **`import()`**
  - **功能**：集中处理并输出全局资源，包括消息提示、警告框、JS/CSS代码等
  - **处理逻辑**：
    - 消息框：从`$viewimport['messagebox']`读取内容并渲染
    - 警告框：从`$viewimport['alert']`读取内容并自动消失
    - JS代码：执行`$viewimport['js']`中的脚本
    - CSS代码：执行`$viewimport['css']`中的样式（需注意应使用style标签而非script）
  - **注意**：`此方法不需要直接调用，header()和foot()会自动处理`

- **`B404()` / `B403()`**
  - **功能**：分别显示404（未找到）和403（禁止访问）错误页面
  - **行为**：加载对应错误页面模板，调用import()后终止脚本执行
  - **使用场景**：在路由处理中检测到无效请求或权限不足时调用

##### 工具函数
- **`icon($name, $other = "")`**
  - **参数**：
    - `$name`: Material Design图标名称（如"home"）
    - `$other`: 额外的CSS类
  - **返回**：格式化的图标HTML元素 `<i class='mdi mdi-$name $other'></i>`
  - **用途**：统一项目图标渲染，简化模板中的图标代码

- **`jsMdLt($id = "pFace", $text)`**
  - **参数**：
    - `$id`: 目标元素ID
    - `$text`: 需要渲染的Markdown文本
  - **功能**：将Markdown文本解析为HTML并插入指定ID的元素中
  - **注意**：自动处理特殊字符转义，确保Markdown内容安全渲染

- **`jsMdLt_GetOnly($id = "pFace", $noecho = 0)`**
  - **参数**：
    - `$id`: 目标元素ID
    - `$noecho`: 是否直接输出（0=输出，1=返回字符串）
  - **功能**：生成将指定元素内容解析为Markdown的脚本
  - **使用场景**：需要动态获取Markdown解析脚本内容时使用

- **`alert($text, $type = "info", $currenttime = 5000)`**
  - **参数**：
    - `$text`: 警告消息内容
    - `$type`: 警告类型（info/success/danger等）
    - `$currenttime`: 自动消失时间（毫秒）
  - **功能**：添加可自动消失的警告框，通过全局变量存储
  - **特点**：使用唯一ID避免冲突，支持Bootstrap样式类型

- **`pageCutNav($now, $total, $url)`**
  - **参数**：
    - `$now`: 当前页码
    - `$total`: 总页数
    - `$url`: 分页基础URL
  - **功能**：智能生成分页导航，自动处理页码范围显示
  - **特点**：
    - 当总页数≤10时显示全部页码
    - 当总页数>10时仅显示当前页前后2页及首尾页
    - 自动处理URL参数拼接，兼容已有GET参数

- **`aceeditor($code = "", $language = "c_cpp", $rl = 0, $outname = "")`**
  - **参数**：
    - `$code`: 初始代码内容
    - `$language`: 代码语言（默认c_cpp）
    - `$rl`: 是否只读（0=可编辑，1=只读）
    - `$outname`: 表单字段名称
  - **功能**：初始化Ace代码编辑器实例
  - **返回**：编辑器实例ID，可用于后续操作
  - **优势**：自动处理特殊字符转义，支持多实例共存

- **`message($text, $title = '消息', $icon = "bell", $time = "刚刚")`**
  - **参数**：
    - `$text`: 消息内容
    - `$title`: 消息标题
    - `$icon`: 图标名称
    - `$time`: 时间描述
  - **功能**：添加消息提示框，支持自定义图标、标题和时间
  - **实现**：使用Bootstrap Toast组件实现，自动集成关闭按钮

- **`addMessage($text, $title = '消息', $icon = "bell", $url = "", $show = 0, $time = "刚刚")`**
  - **参数**：
    - `$text`: 消息内容（支持HTML）
    - `$title`: 消息标题（默认"消息"）
    - `$icon`: 图标名称（Material Design图标名，默认"bell"）
    - `$url`: 点击消息后的跳转URL（可选）
    - `$show`: 是否立即显示（0=仅添加到队列，1=立即显示）
    - `$time`: 时间描述（默认"刚刚"）
  - **功能**：
    - 安全转义消息内容，防止JS注入
    - 将消息添加到JS消息队列（通过`$viewimport['js']`）
    - 可选立即显示消息（调用`message()`方法）
  - **与message()区别**：
    | 特性 | message() | addMessage() |
    |------|-----------|--------------|
    | 输出方式 | 直接输出HTML | 生成JS调用代码 |
    | 显示时机 | 页面加载时立即显示 | 可在页面加载后动态触发 |
    | 适用场景 | 服务端直接渲染消息 | 需要延迟或动态显示的消息 |
  - **前端交互**：
    - 生成`addMessage(title, text, icon, url)`的JS调用
    - 需要前端实现对应的`addMessage`函数处理消息队列
  - **使用场景**：
    - 异步操作后的消息提示（如AJAX请求完成）
    - 需要延迟显示的系统通知
    - 消息队列管理
  - **示例**：
    ```php
    // 添加但不立即显示
    view::addMessage("有新的系统通知", "系统消息", "information", "/notifications");
    
    // 立即显示消息
    view::addMessage("操作成功", "提示", "check", "", 1);
    ```

- **`activeMB()`**
  - **参数**：无
  - **功能**：
    - 显示消息按钮的红色小点

- **`deactiveMB()`**
  - **参数**：无
  - **功能**：
    - 隐藏消息按钮的红色小点

## 最佳实践建议
1. **视图渲染流程**：应遵循 `header() → 内容渲染 → foot()` 的标准流程，确保HTML结构完整性 
2. **资源管理**：使用alert()和message()等方法统一管理提示信息，避免直接echo破坏渲染流程
3. **错误处理**：遇到404/403等错误时应立即调用B404()/B403()并终止脚本，防止后续内容输出
4. **文档规范**：为每个静态方法添加清晰的参数说明和功能描述，提高代码可维护性 
5. **性能考虑**：避免在视图渲染函数中执行复杂逻辑，保持视图层轻量高效

此API设计采用静态方法实现视图渲染控制，符合PHP中实现可重用HTML组件的最佳实践，有效提升了代码复用性和可维护性。